// دریافت اطلاعات محصول از URL
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

// پیدا کردن محصول
let product = null;
if (products && products.length > 0) {
    product = products.find(p => p.id == productId);
}

if (product) {
    document.getElementById('productDetail').innerHTML = `
        <div class="product-detail">
            <div class="product-images">
                <img src="${product.image}" alt="${product.name}" class="main-image" 
                     onclick="openZoom('${product.image}')">
                <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                    برای مشاهده عکس در سایز واقعی کلیک کنید
                </p>
            </div>
            <div class="product-info">
                <span class="product-category">${product.category}</span>
                <h1 class="product-title">${product.name}</h1>
                <p class="product-description-full">${product.description}</p>
                
                <div class="product-specs">
                    <div class="spec-item">
                        <span class="spec-label">کد محصول:</span>
                        <span class="spec-value">${product.code}</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">دسته‌بندی:</span>
                        <span class="spec-value">${product.category}</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">وضعیت موجودی:</span>
                        <span class="spec-value ${product.available ? 'in-stock' : 'out-of-stock'}">
                            ${product.available ? '✅ موجود در انبار' : '❌ ناموجود'}
                        </span>
                    </div>
                </div>
                
                <div class="product-price-section">
                    <span class="price">${product.price}</span>
                    ${product.available ? 
                        `<button class="add-to-cart" onclick="addToCart(${product.id})">➕ افزودن به سبد خرید</button>` : 
                        '<button class="out-of-stock-btn" disabled>ناموجود</button>'
                    }
                </div>
            </div>
        </div>
    `;
    
    // آپدیت title صفحه
    document.title = `${product.name} - PulseGadgett`;
} else {
    document.getElementById('productDetail').innerHTML = `
        <div class="error-message">
            <h2>محصول یافت نشد</h2>
            <p>متأسفانه محصول مورد نظر پیدا نشد.</p>
        </div>
    `;
}

// تابع افزودن به سبد خرید برای صفحه محصول
function addToCart(productId) {
    const product = products.find(p => p.id == productId);
    if (product) {
        // ذخیره در localStorage برای انتقال به صفحه اصلی
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const existingItem = cart.find(item => item.id == productId);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({
                ...product,
                quantity: 1
            });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // نمایش پیام موفقیت
        alert(`✅ ${product.name} به سبد خرید اضافه شد!`);
        
        // بازگشت به صفحه اصلی بعد از 1 ثانیه
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 1000);
    }
}

// توابع زوم عکس (همان قبلی)
function openZoom(imageSrc) {
    const zoomContainer = document.getElementById('imageZoomContainer');
    const zoomedImage = document.getElementById('zoomedImage');
    
    zoomedImage.src = imageSrc;
    zoomContainer.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeZoom() {
    const zoomContainer = document.getElementById('imageZoomContainer');
    zoomContainer.style.display = 'none';
    document.body.style.overflow = 'auto';
}

document.getElementById('imageZoomContainer').addEventListener('click', function(e) {
    if (e.target === this) {
        closeZoom();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeZoom();
    }
});
